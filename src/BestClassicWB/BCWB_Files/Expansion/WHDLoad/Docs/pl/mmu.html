<HTML>
<HEAD>
<TITLE>WHDLoad i MMU</TITLE>
<meta name="DC.Language" content="pl">
<meta http-equiv="content-language" content="pl">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
<!-- $Id: mmu.html 1.7 2014/12/04 23:37:38 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>WHDLoad i Jednostka Zarz±dzaj±ca Pamiêci± (MMU)</h3>
MMU posiadaj± nastêpuj±ce procesory: 68030,
68040, 68060. Istniej± równie¿ tak zwane wersje EC tych procesorów, które
posiadaj± zepsute, niedzia³aj±ce MMU. Dla przyk³adu, wszystkie standardowe A4000/030
posiadaj± procesor 68EC030. Karty turbo wykonane przez firmy trzecie
przedstawiaj± zgo³a odmienn± sytuacjê w tej materii i wiêcej na ich temat
mo¿na dowiedzieæ siê z dostarczanej wraz z nimi dokumentacji.
Z tego co wiem, wszystkie akceleratory 68040/68060 dla Amigi posiadaj± pe³ne procesory,
czyli wyposa¿one w MMU (gdy¿ tryb burst i Zorro III wymagaj± mapowania MMU przez
przestrzeñ urz±dzeñ wej¶cia/wyj¶cia). Brak MMU na procesorach EC nie mo¿e
zostaæ nadrobiony poprzez oprogramowanie. Mimo wszystko, wszystko wymaga osobnych
ustawieñ <a href="#usercontrol">we w³a¶ciwych opcjach</a> WHDLoad.
<br>Procesory 68020 wyposa¿one s± w zewnêtrzne MMU zwane 68851. Póki co, nie jest
ono obs³ugiwane przez WHDload.
<h4>Cechy MMU i wykorzystanie ich przez WHDLoad</h4>
G³ównym zadaniem MMU jest t³umaczenie logicznych adresów na fizyczne.
Wymagane jest to dla pamiêci wirtualnej i wydzielonej przestrzeni adresowej. Kolejn± cech±
jest precyzowanie specjalnych w³a¶ciwo¶ci, takich jak tryb &quot;Tylko Nadzorca&quot; (Supervisor Only),
tryb zabezpieczenia przed zapisem (Write Protected) czy tryb buforowania
dla ka¿dej fizycznej przestrzeni adresowej skonfigurowanej w oparciu o strony pamiêci, które
w WHDLoad posiadaj± rozmiar 4096 bajtów.
WHDLoad nie korzysta z t³umaczenia adresów logicznych na fizyczne. Wykorzystuje
MMU do <a href="#mem">ochrony pamiêci</a>, <a
href="cache.html">zarz±dzania cache</a> i kilku innych specjalnych funkcji (<a
href="snoop.html">Snooping</a>, <A
HREF="../autodoc.html">resload_Protect#?</a>).
<h4><a name="mem">Ochrona pamiêci w WHDLoad</a></h4>.
Na pocz±tku, WHDLoad skanuje listê pamiêci i buduje drzewo t³umaczeñ (translation tree),
które zawiera wszystkie adresy dostêpnej pamiêci. Zaznacza poni¿sze adresy
przestrzeni jak prawid³owe i dostêpne:
$0...BaseMem (wykorzystuj±c informacje z pliku .slave),
$dff000...$dff200 (rejestry Custom), $bfd000...$bff000 (rejestry Cia) i
pamiêc wykorzystana przez plik .slave i WHDLoad. Je¿eli w pamiêci znajduje
siê program zatrzymuj±cy dzia³anie innych programów, pamiêæ przez niego wykorzystywana równie¿ oznaczana jest jako
dostêpna. Ka¿dy inny obszar pamiêci oznaczany jest jako niedostêpny. Ka¿dy
dostêp do takiej pamiêci (zapis lub odczyt) spowoduje wyj±tek b³êdu dostêpu (Access Fault Exception),
który zakoñczony zostanie stosownym komunikatem wytworzonym przez WHDLoad.
<h4><a name="usercontrol">Kontrola MMU w WHDLoad z poziomu u¿ytkownika</a></h4>
Istniej± trzy ró¿ne tryby w jakich WHDLoad mo¿e wp³ywaæ na MMU.
<ol>
<li><b>ignorowanie MMU</b>:<br>
W tym trybie WHDLoad nie zmienia rejestrów MMU. Mo¿e byæ to u¿yteczne
w sytuacji, gdy uruchamiamy programy, które nie ¿ycz± sobie obecno¶ci MMU.
<br>
Ostrze¿enie: poniewa¿ WHDLoad nie kontroluje MMU, mog± wystêpowaæ ró¿ne
problemy. Mog± one powodowaæ zawieszenia, b³êdy lub inne trudne do przewidzenia
zachowania. Oto lista mo¿liwych sytuacji:
<ul>
<li>uruchomienie Enforcera/CyberGuarda lub podobnego narzêdzia zawiesi system
poniewa¿ WHDLoad generuje bardzo du¿o &quot;hitów&quot; za ka¿dym razem, gdy wy³±cza
i w³±cza OS. &quot;Hity&quot; te nie s± b³êdami WHDLoad, lecz elementami normalnych
operacji.
<li>nowsze wersje 68060.library (pocz±wszy od v41.1) remapuj± pamiêæ
$0-$1000 (pierwsza strona) do pamiêci Fast przy pomocy MMU. W przypadku
ignorowania MMU ten adres pozostanie nienaruszony. Je¶li zainstalowany
program próbuje wykorzystaæ ten obszar do jakichkolwiek dzia³añ DMA (np.
wykorzystanie copperlisty w tym obszarze), rezultaty mog± byæ nieprzewidywalne,
gdy¿ procesor bêdzie zapisywa³/odczytywa³ po³o¿enie pamiêci Fast, podczas gdy
prawdziwa pamiêæ Chip wykorzystywana przez DMA zawiera losowe dane.
<li>je¶li uruchamiany program wykorzystuje MMU i korzysta z jakiejkolwiek
dostêpnej pamiêci (exception handler, translation tree, itd.) wewn±trz BaseMem zainstalowanego programu, mo¿e spowodowaæ zawieszenie, poniewa¿ BaseMem zostanie nadpisana podczas wykonywania zainstalowanego programu.
<li>ogólnie, ka¿dy program, który zmienia podstawowe funkcje systemu (u¿ywaj±c
MMU) mo¿e powodowaæ konflikt z WHDLoad ...
</ul>
<li><b>wy³±czenie MMU</b>:<br>
W tym trybie, który jest mo¿liwy tylko na 68030, MMU zostanie wy³±czone przez
WHDLoad. ¯adne funkcje powi±zane z MMU nie s± dostêpne.
<li><b>wykorzystanie MMU</b>:<br>
W tym trybie WHDLoad przejmuje pe³n± kontrolê nad MMU i dokonuje ochrony
pamiêci i zarz±dzania cache tak, jak to opisano powy¿ej.
</ol>
Na 68030 domy¶lnie ustawione jest <i>wy³±czenie MMU</i>. Na 68040/68060 domy¶lnie ustawione jest <i>wykorzystanie MMU</i>.
Istniej± dwie opcje, które to kontroluj±. <a href="opt.html#MMU">MMU/S</a> zmusza WHDLoad do <i>wykorzystania</i> <i>MMU</i> i jest wymagane na procesorach 68030, aby MMU zaczê³o dzia³aæ. <a href="opt.html#NoMMU">NoMMU/S</a> wy³±cza u¿ycie MMU przez WHDLoad (<i>ignorowanie MMU</i>).
<center><p><cite>Czasem &quot;hit&quot; Enforcera jest &quot;hitem&quot; Enforcera.</cite> (Michael Sinz)</p></center>
</BODY>
</HTML>
